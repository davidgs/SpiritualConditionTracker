/*! For license information please see 591.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkspiritual_condition_tracker=self.webpackChunkspiritual_condition_tracker||[]).push([[591],{591:(e,t,r)=>{r.r(t),r.d(t,{add:()=>O,calculateDistance:()=>C,calculateSpiritualFitness:()=>R,getAll:()=>E,getById:()=>S,getPreference:()=>P,hasLocalStorageData:()=>G,initDatabase:()=>g,migrateFromLocalStorage:()=>F,query:()=>J,remove:()=>I,setPreference:()=>L,setupGlobalDbObject:()=>U,update:()=>N});var n=r(864);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(){s=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(e,t,r,n){return Object.defineProperty(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function p(t,r,n,a){var o=r&&r.prototype instanceof h?r:h,i=Object.create(o.prototype);return l(i,"_invoke",function(t,r,n){var a=1;return function(o,i){if(3===a)throw Error("Generator is already running");if(4===a){if("throw"===o)throw i;return{value:e,done:!0}}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var c=S(s,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===a)throw a=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=3;var u=f(t,r,n);if("normal"===u.type){if(a=n.done?4:2,u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=4,n.method="throw",n.arg=u.arg)}}}(t,n,new k(a||[])),!0),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=p;var d={};function h(){}function g(){}function m(){}var y={};l(y,i,(function(){return this}));var v=Object.getPrototypeOf,b=v&&v(v(N([])));b&&b!==r&&n.call(b,i)&&(y=b);var w=m.prototype=h.prototype=Object.create(y);function E(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(o,i,s,c){var u=f(e[o],e,i);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==a(p)&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var o;l(this,"_invoke",(function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return o=o?o.then(a,a):a()}),!0)}function S(t,r){var n=r.method,a=t.i[n];if(a===e)return r.delegate=null,"throw"===n&&t.i.return&&(r.method="return",r.arg=e,S(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var o=f(a,t.i,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,d;var i=o.arg;return i?i.done?(r[t.r]=i.value,r.next=t.n,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,d):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function x(e){this.tryEntries.push(e)}function O(t){var r=t[4]||{};r.type="normal",r.arg=e,t[4]=r}function k(e){this.tryEntries=[[-1]],e.forEach(x,this),this.reset(!0)}function N(t){if(null!=t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,s=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return s.next=s}}throw new TypeError(a(t)+" is not iterable")}return g.prototype=m,l(w,"constructor",m),l(m,"constructor",g),g.displayName=l(m,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,u,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},E(T.prototype),l(T.prototype,c,(function(){return this})),t.AsyncIterator=T,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var i=new T(p(e,r,n,a),o);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(w),l(w,u,"Generator"),l(w,i,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},t.values=N,k.prototype={constructor:k,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e){i.type="throw",i.arg=t,r.next=e}for(var a=r.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o[4],s=this.prev,c=o[1],u=o[2];if(-1===o[0])return n("end"),!1;if(!c&&!u)throw Error("try statement without catch or finally");if(null!=o[0]&&o[0]<=s){if(s<c)return this.method="next",this.arg=e,n(c),!0;if(s<u)return n(u),!1}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var a=n;break}}a&&("break"===e||"continue"===e)&&a[0]<=t&&t<=a[2]&&(a=null);var o=a?a[4]:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a[2],d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[2]===e)return this.complete(r[4],r[3]),O(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[0]===e){var n=r[4];if("throw"===n.type){var a=n.arg;O(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={i:N(t),r,n},"next"===this.method&&(this.arg=e),d}},t}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r){return(t=function(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e,t,r,n,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,a)}function f(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){p(o,n,a,i,s,"next",e)}function s(e){p(o,n,a,i,s,"throw",e)}i(void 0)}))}}var d=null,h=null;function g(){return m.apply(this,arguments)}function m(){return(m=f(s().mark((function e(){var t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Initializing SQLite database for Capacitor..."),e.prev=1,!(0,n.aH)("capacitor")&&!(0,n.aH)("cordova")){e.next=18;break}if(console.log("Using native SQLite implementation via Capacitor"),!(0,n.aH)("capacitor")){e.next=12;break}return e.next=7,r.e(321).then(r.bind(r,321));case 7:t=e.sent,a=t.CapacitorSQLite,h=a,e.next=13;break;case 12:h=window.sqlitePlugin;case 13:return e.next=15,h.openDatabase({name:"spiritualTracker.db",location:"default"});case 15:d=e.sent,e.next=26;break;case 18:if(!window.openDatabase){e.next=23;break}console.log("Using WebSQL implementation for browser"),d=window.openDatabase("spiritualTracker.db","1.0","Spiritual Condition Tracker Database",5242880),e.next=26;break;case 23:return console.warn("SQLite not available - using localStorage fallback"),y(),e.abrupt("return",!1);case 26:return e.next=28,v();case 28:return console.log("SQLite database initialized successfully"),e.abrupt("return",!0);case 32:return e.prev=32,e.t0=e.catch(1),console.error("Error initializing database:",e.t0),y(),e.abrupt("return",!1);case 37:case"end":return e.stop()}}),e,null,[[1,32]])})))).apply(this,arguments)}function y(){function e(e){return JSON.parse(localStorage.getItem(e)||"[]")}function t(e,t){localStorage.setItem(e,JSON.stringify(t))}function r(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=u({},r);return"users"===e&&t.length>=3?(n.id=t[0]||r.id||"user_".concat(Date.now()),n.name=t[1]||r.name,n.lastName=t[2]||r.lastName):"activities"===e&&t.length>=3&&(n.id=t[0]||r.id||"activity_".concat(Date.now()),n.type=t[1]||r.type,n.duration=t[2]||r.duration),n}console.log("Setting up localStorage fallback for data persistence"),d={transaction:function(n){var a={executeSql:function(n,a,o,i){try{var s=n.toLowerCase().trim();s.startsWith("create table")?o({},{rows:{length:0}}):s.startsWith("select")?function(t,r,n){var a=t.match(/from\s+([^\s,)]+)/i);if(!a)throw new Error("Invalid SELECT query: "+t);var o=e(a[1]),i=t.match(/where\s+([^\s]+)\s*=\s*\?/i);if(i&&r.length>0){var s=i[1];o=o.filter((function(e){return e[s]===r[0]}))}n({},{rows:{length:o.length,item:function(e){return o[e]},_array:o}})}(s,a,o):s.startsWith("insert")?function(n,a,o){var i=n.match(/into\s+([^\s(]+)/i);if(!i)throw new Error("Invalid INSERT query: "+n);var s=i[1],c=r(s,a),u=e(s);u.push(c),t(s,u),o({},{insertId:c.id,rowsAffected:1})}(s,a,o):s.startsWith("update")?function(n,a,o){var i=n.match(/update\s+([^\s]+)/i),s=n.match(/where\s+([^\s]+)\s*=\s*\?/i);if(!i||!s)throw new Error("Invalid UPDATE query: "+n);var c=i[1],u=s[1],l=a[a.length-1],p=e(c),f=p.findIndex((function(e){return e[u]===l}));if(-1!==f){var d=r(c,a,p[f]);p[f]=d,t(c,p),o({},{rowsAffected:1})}else o({},{rowsAffected:0})}(s,a,o):s.startsWith("delete")?function(r,n,a){var o=r.match(/from\s+([^\s]+)/i),i=r.match(/where\s+([^\s]+)\s*=\s*\?/i);if(!o||!i)throw new Error("Invalid DELETE query: "+r);var s=o[1],c=i[1],u=n[0],l=e(s),p=l.filter((function(e){return e[c]!==u}));p.length!==l.length?(t(s,p),a({},{rowsAffected:1})):a({},{rowsAffected:0})}(s,a,o):(console.warn("Unsupported SQL query for localStorage:",n),o({},{rows:{length:0}}))}catch(e){console.error("Error in localStorage fallback:",e),i&&i({},e)}}};n(a)}}}function v(){return b.apply(this,arguments)}function b(){return(b=f(s().mark((function e(){var t,r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=2;break}return e.abrupt("return");case 2:t=0,r=["CREATE TABLE IF NOT EXISTS users (\n      id TEXT PRIMARY KEY,\n      name TEXT,\n      lastName TEXT,\n      phoneNumber TEXT,\n      email TEXT,\n      sobrietyDate TEXT,\n      homeGroups TEXT,\n      privacySettings TEXT,\n      preferences TEXT,\n      sponsor TEXT,\n      sponsees TEXT,\n      messagingKeys TEXT,\n      createdAt TEXT,\n      updatedAt TEXT\n    )","CREATE TABLE IF NOT EXISTS activities (\n      id TEXT PRIMARY KEY,\n      type TEXT NOT NULL,\n      duration INTEGER,\n      date TEXT,\n      notes TEXT,\n      meeting TEXT,\n      createdAt TEXT,\n      updatedAt TEXT\n    )","CREATE TABLE IF NOT EXISTS meetings (\n      id TEXT PRIMARY KEY,\n      name TEXT NOT NULL,\n      days TEXT,\n      time TEXT,\n      schedule TEXT,\n      address TEXT,\n      locationName TEXT,\n      streetAddress TEXT,\n      city TEXT,\n      state TEXT,\n      zipCode TEXT,\n      coordinates TEXT,\n      createdAt TEXT,\n      updatedAt TEXT\n    )","CREATE TABLE IF NOT EXISTS messages (\n      id TEXT PRIMARY KEY,\n      senderId TEXT,\n      recipientId TEXT,\n      content TEXT,\n      encrypted INTEGER,\n      timestamp TEXT,\n      read INTEGER\n    )","CREATE TABLE IF NOT EXISTS preferences (\n      id TEXT PRIMARY KEY,\n      value TEXT,\n      createdAt TEXT,\n      updatedAt TEXT\n    )"];case 4:if(!(t<r.length)){e.next=11;break}return n=r[t],e.next=8,w(n);case 8:t++,e.next=4;break;case 11:console.log("All database tables created successfully");case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Promise((function(r,n){d?d.transaction((function(a){a.executeSql(e,t,(function(e,t){return r(t)}),(function(e,t){return console.error("SQL Error:",t),n(t),!1}))})):n(new Error("Database not initialized"))}))}function E(e){return T.apply(this,arguments)}function T(){return(T=f(s().mark((function e(t){var r,n,a,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w("SELECT * FROM ".concat(t));case 3:for(r=e.sent,n=[],a=r.rows.length,o=0;o<a;o++)i=r.rows.item(o),"users"===t?(i.privacySettings=JSON.parse(i.privacySettings||"{}"),i.preferences=JSON.parse(i.preferences||"{}"),i.homeGroups=JSON.parse(i.homeGroups||"[]"),i.sponsor=JSON.parse(i.sponsor||"null"),i.sponsees=JSON.parse(i.sponsees||"[]"),i.messagingKeys=JSON.parse(i.messagingKeys||"{}")):"meetings"===t?(i.days=JSON.parse(i.days||"[]"),i.schedule=JSON.parse(i.schedule||"[]"),i.coordinates=JSON.parse(i.coordinates||"null")):"preferences"===t&&(i.value=JSON.parse(i.value||"null")),n.push(i);return e.abrupt("return",n);case 10:return e.prev=10,e.t0=e.catch(0),console.error("Error getting all items from ".concat(t,":"),e.t0),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function S(e,t){return x.apply(this,arguments)}function x(){return(x=f(s().mark((function e(t,r){var n,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w("SELECT * FROM ".concat(t," WHERE id = ?"),[r]);case 3:if(0!==(n=e.sent).rows.length){e.next=6;break}return e.abrupt("return",null);case 6:return a=n.rows.item(0),"users"===t?(a.privacySettings=JSON.parse(a.privacySettings||"{}"),a.preferences=JSON.parse(a.preferences||"{}"),a.homeGroups=JSON.parse(a.homeGroups||"[]"),a.sponsor=JSON.parse(a.sponsor||"null"),a.sponsees=JSON.parse(a.sponsees||"[]"),a.messagingKeys=JSON.parse(a.messagingKeys||"{}")):"meetings"===t?(a.days=JSON.parse(a.days||"[]"),a.schedule=JSON.parse(a.schedule||"[]"),a.coordinates=JSON.parse(a.coordinates||"null")):"preferences"===t&&(a.value=JSON.parse(a.value||"null")),e.abrupt("return",a);case 11:return e.prev=11,e.t0=e.catch(0),console.error("Error getting item by ID from ".concat(t,":"),e.t0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function O(e,t){return k.apply(this,arguments)}function k(){return(k=f(s().mark((function e(t,r){var n,a,o,i,c,u,l,p,f,d,h,g,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r.id||(r.id="".concat(t.slice(0,-1),"_").concat(Date.now())),n=(new Date).toISOString(),r.createdAt=r.createdAt||n,r.updatedAt=n,"users"!==t){e.next=17;break}c=JSON.stringify(r.privacySettings||{}),u=JSON.stringify(r.preferences||{}),l=JSON.stringify(r.homeGroups||[]),p=JSON.stringify(r.sponsor||null),f=JSON.stringify(r.sponsees||[]),d=JSON.stringify(r.messagingKeys||{}),a="id, name, lastName, phoneNumber, email, sobrietyDate, homeGroups, privacySettings, preferences, sponsor, sponsees, messagingKeys, createdAt, updatedAt",o="?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?",i=[r.id,r.name,r.lastName,r.phoneNumber,r.email,r.sobrietyDate,l,c,u,p,f,d,r.createdAt,r.updatedAt],e.next=45;break;case 17:if("activities"!==t){e.next=23;break}a="id, type, duration, date, notes, meeting, createdAt, updatedAt",o="?, ?, ?, ?, ?, ?, ?, ?",i=[r.id,r.type,r.duration,r.date,r.notes,r.meeting,r.createdAt,r.updatedAt],e.next=45;break;case 23:if("meetings"!==t){e.next=32;break}h=JSON.stringify(r.days||[]),g=JSON.stringify(r.schedule||[]),m=JSON.stringify(r.coordinates||null),a="id, name, days, time, schedule, address, locationName, streetAddress, city, state, zipCode, coordinates, createdAt, updatedAt",o="?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?",i=[r.id,r.name,h,r.time,g,r.address,r.locationName,r.streetAddress,r.city,r.state,r.zipCode,m,r.createdAt,r.updatedAt],e.next=45;break;case 32:if("messages"!==t){e.next=38;break}a="id, senderId, recipientId, content, encrypted, timestamp, read",o="?, ?, ?, ?, ?, ?, ?",i=[r.id,r.senderId,r.recipientId,r.content,r.encrypted?1:0,r.timestamp,r.read?1:0],e.next=45;break;case 38:if("preferences"!==t){e.next=44;break}a="id, value, createdAt, updatedAt",o="?, ?, ?, ?",i=[r.id,JSON.stringify(r.value),r.createdAt,r.updatedAt],e.next=45;break;case 44:throw new Error("Unknown collection: ".concat(t));case 45:return e.next=47,w("INSERT INTO ".concat(t," (").concat(a,") VALUES (").concat(o,")"),i);case 47:return console.log("Added item to ".concat(t," with ID: ").concat(r.id)),e.abrupt("return",r);case 51:throw e.prev=51,e.t0=e.catch(0),console.error("Error adding item to ".concat(t,":"),e.t0),e.t0;case 55:case"end":return e.stop()}}),e,null,[[0,51]])})))).apply(this,arguments)}function N(e,t,r){return A.apply(this,arguments)}function A(){return(A=f(s().mark((function e(t,r,n){var a,o,i,c,l,p,f,d,h,g,m,y,v;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n.updatedAt=(new Date).toISOString(),e.next=4,S(t,r);case 4:if(a=e.sent){e.next=8;break}return console.log("Item with ID ".concat(r," not found in ").concat(t)),e.abrupt("return",null);case 8:if(o=u(u({},a),n),"users"!==t){e.next=20;break}l=JSON.stringify(o.privacySettings||{}),p=JSON.stringify(o.preferences||{}),f=JSON.stringify(o.homeGroups||[]),d=JSON.stringify(o.sponsor||null),h=JSON.stringify(o.sponsees||[]),g=JSON.stringify(o.messagingKeys||{}),i="name = ?, lastName = ?, phoneNumber = ?, email = ?, sobrietyDate = ?, homeGroups = ?, privacySettings = ?, preferences = ?, sponsor = ?, sponsees = ?, messagingKeys = ?, updatedAt = ?",c=[o.name,o.lastName,o.phoneNumber,o.email,o.sobrietyDate,f,l,p,d,h,g,o.updatedAt,r],e.next=44;break;case 20:if("activities"!==t){e.next=25;break}i="type = ?, duration = ?, date = ?, notes = ?, meeting = ?, updatedAt = ?",c=[o.type,o.duration,o.date,o.notes,o.meeting,o.updatedAt,r],e.next=44;break;case 25:if("meetings"!==t){e.next=33;break}m=JSON.stringify(o.days||[]),y=JSON.stringify(o.schedule||[]),v=JSON.stringify(o.coordinates||null),i="name = ?, days = ?, time = ?, schedule = ?, address = ?, locationName = ?, streetAddress = ?, city = ?, state = ?, zipCode = ?, coordinates = ?, updatedAt = ?",c=[o.name,m,o.time,y,o.address,o.locationName,o.streetAddress,o.city,o.state,o.zipCode,v,o.updatedAt,r],e.next=44;break;case 33:if("messages"!==t){e.next=38;break}i="content = ?, encrypted = ?, read = ?",c=[o.content,o.encrypted?1:0,o.read?1:0,r],e.next=44;break;case 38:if("preferences"!==t){e.next=43;break}i="value = ?, updatedAt = ?",c=[JSON.stringify(o.value),o.updatedAt,r],e.next=44;break;case 43:throw new Error("Unknown collection: ".concat(t));case 44:return e.next=46,w("UPDATE ".concat(t," SET ").concat(i," WHERE id = ?"),c);case 46:if(0!==e.sent.rowsAffected){e.next=50;break}return console.log("No rows affected when updating ".concat(t," with ID: ").concat(r)),e.abrupt("return",null);case 50:return console.log("Updated item in ".concat(t," with ID: ").concat(r)),e.abrupt("return",o);case 54:throw e.prev=54,e.t0=e.catch(0),console.error("Error updating item in ".concat(t,":"),e.t0),e.t0;case 58:case"end":return e.stop()}}),e,null,[[0,54]])})))).apply(this,arguments)}function I(e,t){return X.apply(this,arguments)}function X(){return(X=f(s().mark((function e(t,r){var n,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w("DELETE FROM ".concat(t," WHERE id = ?"),[r]);case 3:return n=e.sent,(a=n.rowsAffected>0)?console.log("Removed item from ".concat(t," with ID: ").concat(r)):console.log("No item found in ".concat(t," with ID: ").concat(r)),e.abrupt("return",a);case 9:return e.prev=9,e.t0=e.catch(0),console.error("Error removing item from ".concat(t,":"),e.t0),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function J(e,t){return D.apply(this,arguments)}function D(){return(D=f(s().mark((function e(t,r){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E(t);case 3:return n=e.sent,e.abrupt("return",n.filter(r));case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error querying ".concat(t,":"),e.t0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function P(e){return j.apply(this,arguments)}function j(){return(j=f(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,S("preferences",t);case 3:return r=e.sent,e.abrupt("return",null==r?void 0:r.value);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error getting preference ".concat(t,":"),e.t0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function L(e,t){return M.apply(this,arguments)}function M(){return(M=f(s().mark((function e(t,r){var n,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=(new Date).toISOString(),a={id:t,value:r,createdAt:n,updatedAt:n},e.next=5,S("preferences",t);case 5:if(!e.sent){e.next=11;break}return e.next=9,N("preferences",t,{value:r,updatedAt:n});case 9:e.next=13;break;case 11:return e.next=13,O("preferences",a);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error("Error setting preference ".concat(t,":"),e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function R(e){return _.apply(this,arguments)}function _(){return _=f(s().mark((function e(t){var r,n,a,o,i,c,u,l,p,f,d,h,g,m=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:30,t&&0!==t.length){e.next=3;break}return e.abrupt("return",20);case 3:return e.prev=3,e.next=6,P("fitnessTimeframe");case 6:if(n=e.sent,a=n?parseInt(n,10):r,i=o=20,c=new Date,(u=new Date).setDate(u.getDate()-a),0!==(l=t.filter((function(e){return new Date(e.date)>=u&&new Date(e.date)<=c}))).length){e.next=16;break}return e.abrupt("return",o);case 16:return p=Math.min(40,2*l.length),f={},l.forEach((function(e){var t=new Date(e.date).toISOString().split("T")[0];f[t]||(f[t]=[]),f[t].push(e)})),d=Object.keys(f).length,h=d/a,g=Math.round(40*h),i=o+p+g,i=Math.min(100,i),i=Math.round(100*i)/100,e.abrupt("return",i);case 28:return e.prev=28,e.t0=e.catch(3),console.error("Error calculating spiritual fitness:",e.t0),e.abrupt("return",20);case 32:case"end":return e.stop()}}),e,null,[[3,28]])}))),_.apply(this,arguments)}function C(e,t,r,n){if(e===r&&t===n)return 0;var a=Math.PI*e/180,o=Math.PI*r/180,i=t-n,s=Math.PI*i/180,c=Math.sin(a)*Math.sin(o)+Math.cos(a)*Math.cos(o)*Math.cos(s);return c>1&&(c=1),60*(c=180*(c=Math.acos(c))/Math.PI)*1.1515}function G(){return!!(localStorage.getItem("user")||localStorage.getItem("activities")||localStorage.getItem("meetings")||localStorage.getItem("messages"))}function F(){return K.apply(this,arguments)}function K(){return(K=f(s().mark((function e(){var t,r,n,a,i,c,u,l,p,f,d,h,g;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Starting migration from localStorage to SQLite..."),e.prev=1,!(t=JSON.parse(localStorage.getItem("user")))){e.next=7;break}return console.log("Migrating user data..."),e.next=7,O("users",t);case 7:if(!((r=JSON.parse(localStorage.getItem("activities")||"[]")).length>0)){e.next=27;break}console.log("Migrating ".concat(r.length," activities...")),n=o(r),e.prev=11,n.s();case 13:if((a=n.n()).done){e.next=19;break}return i=a.value,e.next=17,O("activities",i);case 17:e.next=13;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(11),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:if(!((c=JSON.parse(localStorage.getItem("meetings")||"[]")).length>0)){e.next=47;break}console.log("Migrating ".concat(c.length," meetings...")),u=o(c),e.prev=31,u.s();case 33:if((l=u.n()).done){e.next=39;break}return p=l.value,e.next=37,O("meetings",p);case 37:e.next=33;break;case 39:e.next=44;break;case 41:e.prev=41,e.t1=e.catch(31),u.e(e.t1);case 44:return e.prev=44,u.f(),e.finish(44);case 47:if(!((f=JSON.parse(localStorage.getItem("messages")||"[]")).length>0)){e.next=67;break}console.log("Migrating ".concat(f.length," messages...")),d=o(f),e.prev=51,d.s();case 53:if((h=d.n()).done){e.next=59;break}return g=h.value,e.next=57,O("messages",g);case 57:e.next=53;break;case 59:e.next=64;break;case 61:e.prev=61,e.t2=e.catch(51),d.e(e.t2);case 64:return e.prev=64,d.f(),e.finish(64);case 67:return console.log("Migration completed successfully!"),e.abrupt("return",!0);case 71:return e.prev=71,e.t3=e.catch(1),console.error("Error during migration:",e.t3),e.abrupt("return",!1);case 75:case"end":return e.stop()}}),e,null,[[1,71],[11,21,24,27],[31,41,44,47],[51,61,64,67]])})))).apply(this,arguments)}function U(){return window.db={getAll:E,getById:S,add:O,update:N,remove:I,query:J,calculateDistance:C,getPreference:P,setPreference:L,calculateSpiritualFitness:R,hasLocalStorageData:G,migrateFromLocalStorage:F},window.db}}}]);
//# sourceMappingURL=591.bundle.js.map