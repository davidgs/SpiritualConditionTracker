<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spiritual Condition Tracker</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="icon" href="assets/favicon.png">
  
  <!-- SQLite WASM library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
  
  <script>
    // Initialize the SQLite database when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Spiritual Condition Tracker App loaded');
      
      // Set up a global variable to track initialization status
      window.dbInitialized = false;
      
      // Initialize the database
      initDatabase();
    });
    
    // Initialize the database
    async function initDatabase() {
      try {
        console.log('Initializing web localStorage database...');
        // For now, we'll use localStorage as a fallback
        // Later, we'll properly implement SQLite with WebAssembly
        window.dbInitialized = true;
        console.log('Web localStorage database initialized');
        console.log('Database initialized successfully');
        console.log('Using localStorage database implementation');
        
        // Create a test user if none exists
        setTimeout(createTestUser, 2000);
      } catch (error) {
        console.error('Error initializing database:', error);
      }
    }
    
    // Create a test user for demonstration
    function createTestUser() {
      const storedUser = localStorage.getItem('user');
      if (!storedUser) {
        const user = {
          id: 'user_' + Date.now(),
          name: 'John D.',
          sobrietyDate: '2020-01-01',
          homeGroup: 'Downtown Group',
          phone: '',
          email: '',
          privacySettings: { shareLocation: false, shareActivities: false },
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };
        
        localStorage.setItem('user', JSON.stringify(user));
        console.log('Created test user with ID:', user.id);
      }
    }
  </script>
</head>
<body>
  <div id="root">
    <!-- App will be loaded here -->
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading Spiritual Condition Tracker...</p>
    </div>
  </div>
  
  <script src="database.js"></script>
  <script src="app.js"></script>
</body>
</html>