# Nginx configuration snippet to fix the index.bundle 500 error
# Include this in your server block or add to /etc/nginx/conf.d/

# Create a directory for static files
# mkdir -p /var/www/static/

# Copy the static-bundle.js to this location and rename it
# cp static-bundle.js /var/www/static/index.bundle

# Static bundle location
location = /index.bundle {
    # Disable any processing, serve file as-is
    # Removed 'internal' directive to allow direct client access
    alias /var/www/static/index.bundle;
    default_type application/javascript;
    
    # Add CORS headers if needed
    add_header Access-Control-Allow-Origin *;
    
    # Disable caching during testing
    add_header Cache-Control "no-store, no-cache, must-revalidate";
}

# Also handle the /app/index.bundle path
location = /app/index.bundle {
    # Disable any processing, serve file as-is
    # Removed 'internal' directive to allow direct client access
    alias /var/www/static/index.bundle;
    default_type application/javascript;
    
    # Add CORS headers if needed
    add_header Access-Control-Allow-Origin *;
    
    # Disable caching during testing
    add_header Cache-Control "no-store, no-cache, must-revalidate";
}

# Continue with your regular proxy to the Expo server
# For all other requests
location / {
    # Your existing proxy to port 3243
    proxy_pass http://localhost:3243;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
}